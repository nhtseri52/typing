<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Typing Test Ti·∫øng Vi·ªát</title>

<style>
body {
  margin:0;
  background:#0f0f0f;
  color:#fff;
  font-family:Arial,sans-serif;
  text-align:center;
}
.container {
  max-width:700px;
  margin:30px auto;
  padding:20px;
}
#text {
  background:#000;
  padding:15px;
  border-radius:8px;
  height:64px;
  overflow:hidden;
  font-size:20px;
  line-height:32px;
  margin-bottom:10px;
}
.current { text-decoration:underline; }
input {
  width:100%;
  height:45px;
  font-size:18px;
  border-radius:8px;
  border:none;
  padding:0 10px;
  outline:none;
}
button {
  margin:4px;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
#stats { margin-top:8px; }
#rank { text-align:left; margin-top:15px; font-size:14px; }
</style>
</head>

<body>
<div class="container">
  <h2>Typing Test Ti·∫øng Vi·ªát</h2>

  <div id="text"></div>

  <input id="input"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="off"
    spellcheck="false">

  <div>
    <button onclick="start(30)">30s</button>
    <button onclick="start(60)">1p</button>
    <button onclick="start(120)">2p</button>
    <button onclick="start(300)">5p</button>
    <button onclick="start(600)">10p</button>
  </div>

  <div id="stats">Ch·ªçn th·ªùi gian</div>

  <div id="rank">
    üèÜ Top 100
    <ol id="list"></ol>
  </div>
</div>

<script>
const raw = "ch√†o|h·ªçc sinh|c√¥ ·∫•y|ƒëi h·ªçc|l·∫≠p tr√¨nh|m√°y t√≠nh|b√†n ph√≠m|t·ªëc ƒë·ªô|ki·ªÉm tra|vi·ªát nam|h√† n·ªôi|cu·ªôc s·ªëng|c√¥ng ngh·ªá|ph·∫ßn m·ªÅm|k·ªπ nƒÉng";
const words = raw.split("|");

let text=[], index=0, startTime=0, duration=0, timer=null;

function removeAccent(s){
  return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();
}

function genText(){
  text=[];
  for(let i=0;i<60;i++){
    text.push(words[Math.floor(Math.random()*words.length)]);
  }
  index=0;
  render();
}

function render(){
  const el=document.getElementById("text");
  const show=text.slice(index,index+14);
  el.innerHTML=show.map((w,i)=>{
    return `<span class="${i===0?'current':''}">${w} </span>`;
  }).join("");
}

const input=document.getElementById("input");
input.addEventListener("keydown",e=>{
  if(e.key!==" ") return;
  e.preventDefault();
  if(!startTime) startTime=Date.now();

  const typed=removeAccent(input.value.trim());
  const cur=removeAccent(text[index]);
  if(typed===cur) index++;

  input.value="";
  render();
  update();
});

function start(sec){
  clearTimeout(timer);
  duration=sec;
  genText();
  input.value="";
  let c=3;
  document.getElementById("stats").innerText=c;
  const cd=setInterval(()=>{
    c--;
    if(c===0){
      clearInterval(cd);
      document.getElementById("stats").innerText="GO!";
      startTime=Date.now();
      timer=setTimeout(end,sec*1000);
    }else{
      document.getElementById("stats").innerText=c;
    }
  },1000);
}

function update(){
  const t=(Date.now()-startTime)/60000;
  const wpm=Math.round(index/t||0);
  document.getElementById("stats").innerText=`WPM: ${wpm}`;
}

function end(){
  const t=(Date.now()-startTime)/60000;
  const wpm=Math.round(index/t||0);
  save(wpm);
  load();
  alert("Ho√†n th√†nh: "+wpm+" WPM");
}

function save(wpm){
  let r=JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({wpm});
  r.sort((a,b)=>b.wpm-a.wpm);
  r=r.slice(0,100);
  localStorage.setItem("rank",JSON.stringify(r));
}

function load(){
  const l=document.getElementById("list");
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  l.innerHTML="";
  r.forEach(x=>l.innerHTML+=`<li>${x.wpm} WPM</li>`);
}

genText();
load();
</script>
</body>
</html>
