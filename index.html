<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Typing Test Ti·∫øng Vi·ªát</title>
<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:Arial;
  text-align:center;
  margin:0;
}
.container { max-width:800px; margin:auto; padding:20px }
.words {
  font-size:22px;
  background:#1a1a1a;
  padding:15px;
  border-radius:8px;
  margin-bottom:10px;
  min-height:60px;
}
input {
  width:100%;
  padding:12px;
  font-size:18px;
  border-radius:6px;
  border:none;
  outline:none;
}
button {
  margin:4px;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.timer-btn { background:#333; color:#fff }
.active { background:#00b894 }
.rank {
  margin-top:20px;
  text-align:left;
  font-size:14px;
}
.hidden { display:none }
</style>
</head>

<body>
<div class="container">

<h2>‚å® Typing Test Ti·∫øng Vi·ªát</h2>

<div id="auth">
  <input id="user" placeholder="T√™n ƒëƒÉng nh·∫≠p">
  <input id="pass" type="password" placeholder="M·∫≠t kh·∫©u">
  <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
  <button onclick="register()">ƒêƒÉng k√Ω</button>
</div>

<p id="welcome"></p>

<div id="game" class="hidden">
  <div>
    <button class="timer-btn" onclick="setTime(30)">30s</button>
    <button class="timer-btn" onclick="setTime(60)">1p</button>
    <button class="timer-btn" onclick="setTime(120)">2p</button>
    <button class="timer-btn" onclick="setTime(300)">5p</button>
    <button class="timer-btn" onclick="setTime(600)">10p</button>
  </div>

  <p id="countdown"></p>

  <div class="words" id="words"></div>
  <input id="input" disabled placeholder="B·∫Øt ƒë·∫ßu g√µ...">

  <p>‚è± <span id="time">0</span>s | ‚ö° WPM: <span id="wpm">0</span></p>

  <div class="rank">
    <h3>üèÜ Top 100</h3>
    <ol id="ranking"></ol>
  </div>
</div>

</div>

<script>
const wordList = "ch√†o|h·ªçc sinh|c√¥ ·∫•y|chanh|b√°nh m√¨|th·∫ø gi·ªõi|vi·ªát nam|h√† n·ªôi|th√†nh ph·ªë|√¢m nh·∫°c|cu·ªôc s·ªëng|m√°y t√≠nh|l·∫≠p tr√¨nh|b√†n ph√≠m|t·ªëc ƒë·ªô|ki√™n tr√¨|th√†nh c√¥ng".split("|");

let timeLeft=0, timer, started=false, words=[], index=0, correct=0, currentUser=null;

function randomWords(n=30){
  let arr=[];
  for(let i=0;i<n;i++) arr.push(wordList[Math.floor(Math.random()*wordList.length)]);
  return arr;
}

function renderWords(){
  document.getElementById("words").innerHTML =
    words.map((w,i)=>`<span style="color:${i===index?'#00cec9':'#aaa'}">${w}</span>`).join(" ");
}

function setTime(t){
  if(!currentUser) return;
  timeLeft=t;
  document.getElementById("countdown").innerText="B·∫Øt ƒë·∫ßu sau 3...";
  let c=3;
  let cd=setInterval(()=>{
    c--;
    document.getElementById("countdown").innerText=c>0?`B·∫Øt ƒë·∫ßu sau ${c}...`:"GO!";
    if(c<=0){
      clearInterval(cd);
      start();
    }
  },1000);
}

function start(){
  words=randomWords();
  index=0; correct=0;
  started=true;
  document.getElementById("input").disabled=false;
  document.getElementById("input").value="";
  renderWords();
  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("time").innerText=timeLeft;
    if(timeLeft<=0) end();
  },1000);
}

document.getElementById("input").addEventListener("keydown",e=>{
  if(e.key===" "){
    e.preventDefault();
    if(e.target.value.trim()===words[index]) correct++;
    index++;
    e.target.value="";
    renderWords();
  }
});

function end(){
  clearInterval(timer);
  document.getElementById("input").disabled=true;
  let wpm=Math.round(correct*60/(timeLeft+1));
  document.getElementById("wpm").innerText=wpm;
  saveRank(wpm);
}

function saveRank(wpm){
  let ranks=JSON.parse(localStorage.getItem("rank")||"[]");
  ranks.push({user:currentUser,wpm});
  ranks.sort((a,b)=>b.wpm-a.wpm);
  ranks=ranks.slice(0,100);
  localStorage.setItem("rank",JSON.stringify(ranks));
  renderRank();
}

function renderRank(){
  let ranks=JSON.parse(localStorage.getItem("rank")||"[]");
  document.getElementById("ranking").innerHTML =
    ranks.map(r=>`<li>${r.user} - ${r.wpm} WPM</li>`).join("");
}

function register(){
  let u=user.value,p=pass.value;
  if(!u||!p) return alert("Thi·∫øu th√¥ng tin");
  let acc=JSON.parse(localStorage.getItem("acc")||"{}");
  if(acc[u]) return alert("T√†i kho·∫£n t·ªìn t·∫°i");
  acc[u]=p;
  localStorage.setItem("acc",JSON.stringify(acc));
  alert("ƒêƒÉng k√Ω OK");
}

function login(){
  let u=user.value,p=pass.value;
  let acc=JSON.parse(localStorage.getItem("acc")||"{}");
  if(acc[u]!==p) return alert("Sai th√¥ng tin");
  currentUser=u;
  document.getElementById("auth").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  document.getElementById("welcome").innerText="Xin ch√†o "+u;
  renderRank();
}
</script>
</body>
</html>
