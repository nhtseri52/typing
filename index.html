<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Typing Test Ti·∫øng Vi·ªát</title>
<style>
body{
  margin:0;
  font-family: system-ui, sans-serif;
  background:#0f0f0f;
  color:#fff;
  text-align:center;
}
.container{max-width:800px;margin:auto;padding:20px}
h1{margin-bottom:5px}
button{
  background:#222;color:#fff;border:none;
  padding:8px 12px;margin:4px;border-radius:6px;
}
button.active{background:#00c2a8}
#textBox{
  background:#1b1b1b;
  padding:16px;
  border-radius:8px;
  margin:16px 0;
  line-height:1.8;
  height:4.2em;
  overflow:hidden;
}
.word{opacity:.4;margin-right:6px}
.word.current{opacity:1;color:#00e5ff}
.word.done{opacity:.25}
input{
  width:100%;
  padding:12px;
  font-size:18px;
  border-radius:6px;
  border:none;
}
#rank{margin-top:20px;text-align:left}
small{opacity:.6}
</style>
</head>

<body>
<div class="container">
  <h1>‚å®Ô∏è Typing Test Ti·∫øng Vi·ªát</h1>
  <div id="hello"></div>

  <div>
    <button onclick="setTime(30)">30s</button>
    <button onclick="setTime(60)">1p</button>
    <button onclick="setTime(120)">2p</button>
    <button onclick="setTime(300)">5p</button>
    <button onclick="setTime(600)">10p</button>
  </div>

  <button onclick="start()">GO</button>

  <div id="textBox"></div>

  <input id="input"
    placeholder="G√µ t·ª´‚Ä¶ (·∫•n SPACE ƒë·ªÉ qua t·ª´)"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="off"
    spellcheck="false">

  <div>
    ‚è± <span id="time">0</span>s |
    ‚ö° WPM: <span id="wpm">0</span>
  </div>

  <div id="rank">
    üèÜ <b>Top 100</b>
    <ol id="rankList"></ol>
  </div>
</div>

<script>
/* ===== DATA ===== */
const RAW_WORDS =
"th√†nh c√¥ng|l·∫≠p tr√¨nh|chƒÉm ch·ªâ|b√°nh m√¨|cu·ªôc s·ªëng|vi·ªát nam|th·∫ø gi·ªõi|ki√™n tr√¨|t·ªëc ƒë·ªô|b√†n ph√≠m|h·ªçc sinh|c√¥ ·∫•y|th√†nh ph·ªë|h√† n·ªôi|s√†i g√≤n|l·ªãch s·ª≠|vƒÉn h√≥a|c√¥ng ngh·ªá|s√°ng t·∫°o|t∆∞∆°ng lai";

let words=[], index=0, time=60, timer=null, startTime=0, typed=0;

/* ===== LOGIN ===== */
let user = localStorage.getItem("user");
if(!user){
  user = prompt("Nh·∫≠p t√™n c·ªßa b·∫°n:");
  if(!user) user="Guest";
  localStorage.setItem("user",user);
}
document.getElementById("hello").innerText = "Xin ch√†o " + user;

/* ===== INIT ===== */
function shuffle(){
  words = RAW_WORDS.split("|").sort(()=>Math.random()-0.5);
  index=0; typed=0;
  render();
}
function render(){
  const box=document.getElementById("textBox");
  box.innerHTML="";
  words.slice(index,index+20).forEach((w,i)=>{
    const s=document.createElement("span");
    s.className="word"+(i===0?" current":"");
    s.innerText=w;
    box.appendChild(s);
  });
}
shuffle();

/* ===== INPUT ===== */
const input=document.getElementById("input");
input.addEventListener("keydown",e=>{
  if(e.key===" "){
    e.preventDefault();
    if(input.value.trim()==words[index]){
      index++; typed++;
      shuffleIfNeeded();
    }
    input.value="";
  }
});

function shuffleIfNeeded(){
  if(index>5){
    words.splice(0,index);
    index=0;
  }
  render();
}

/* ===== TIMER ===== */
function setTime(t){
  time=t;
  document.getElementById("time").innerText=time;
}
function start(){
  clearInterval(timer);
  shuffle();
  document.getElementById("wpm").innerText=0;
  let c=3;
  document.getElementById("time").innerText=c;
  timer=setInterval(()=>{
    c--;
    document.getElementById("time").innerText=c;
    if(c<=0){
      clearInterval(timer);
      realStart();
    }
  },1000);
}
function realStart(){
  let t=time;
  startTime=Date.now();
  document.getElementById("time").innerText=t;
  timer=setInterval(()=>{
    t--;
    document.getElementById("time").innerText=t;
    calcWPM();
    if(t<=0){finish();}
  },1000);
}
function calcWPM(){
  const min=(Date.now()-startTime)/60000;
  document.getElementById("wpm").innerText=
    Math.round(typed/min||0);
}
function finish(){
  clearInterval(timer);
  saveRank();
}

/* ===== RANK ===== */
function saveRank(){
  const wpm=document.getElementById("wpm").innerText;
  let r=JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({user,wpm:+wpm});
  r=r.sort((a,b)=>b.wpm-a.wpm).slice(0,100);
  localStorage.setItem("rank",JSON.stringify(r));
  showRank();
}
function showRank(){
  const list=document.getElementById("rankList");
  list.innerHTML="";
  (JSON.parse(localStorage.getItem("rank")||"[]")).forEach(e=>{
    const li=document.createElement("li");
    li.innerText=`${e.user} ‚Äì ${e.wpm} WPM`;
    list.appendChild(li);
  });
}
showRank();
</script>
</body>
</html>
