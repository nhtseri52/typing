<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Typing Test Ti·∫øng Vi·ªát</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  text-align: center;
}

.container {
  max-width: 700px;
  margin: 40px auto;
  background: #1c1c1c;
  padding: 20px;
  border-radius: 12px;
}

#textDisplay {
  background: #000;
  padding: 15px;
  border-radius: 8px;
  min-height: 90px;
  font-size: 20px;
  line-height: 1.6;
  margin-bottom: 10px;
  word-wrap: break-word;
}

.correct { color: #4caf50; }
.wrong { color: #f44336; }
.current { text-decoration: underline; }

input {
  width: 100%;
  height: 45px;
  font-size: 18px;
  border-radius: 8px;
  border: none;
  padding: 0 10px;
  outline: none;
}

button {
  margin: 5px;
  padding: 8px 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

#stats {
  margin-top: 10px;
}

#ranking {
  text-align: left;
  margin-top: 15px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="container">
  <h2>Typing Test Ti·∫øng Vi·ªát</h2>

  <div id="textDisplay"></div>

  <input id="input"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="off"
    spellcheck="false"
  >

  <div>
    <button onclick="startTest(30)">30s</button>
    <button onclick="startTest(60)">1p</button>
    <button onclick="startTest(120)">2p</button>
    <button onclick="startTest(300)">5p</button>
    <button onclick="startTest(600)">10p</button>
  </div>

  <div id="stats">WPM: 0 | Accuracy: 100%</div>

  <div id="ranking">
    üèÜ Top 100 Ranking
    <ol id="rankList"></ol>
  </div>
</div>

<script>
const wordsRaw = "ch√†o|h·ªçc sinh|c√¥ ·∫•y|ƒëi h·ªçc|l·∫≠p tr√¨nh|m√°y t√≠nh|b√†n ph√≠m|t·ªëc ƒë·ªô|ki·ªÉm tra|g√µ ch·ªØ|vi·ªát nam|h√¥m nay|ng√†y mai|ki·∫øn th·ª©c|ph·∫ßn m·ªÅm";
const words = wordsRaw.split("|");

let text = [];
let index = 0;
let startTime = null;
let duration = null;
let timer = null;

function removeDiacritics(str) {
  return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

function generateText() {
  text = [];
  for (let i = 0; i < 50; i++) {
    text.push(words[Math.floor(Math.random() * words.length)]);
  }
  index = 0;
  renderText();
}

function renderText() {
  const el = document.getElementById("textDisplay");
  el.innerHTML = text.map((w, i) => {
    let cls = "";
    if (i < index) cls = "correct";
    if (i === index) cls = "current";
    return `<span class="${cls}">${w} </span>`;
  }).join("");
}

document.getElementById("input").addEventListener("input", e => {
  if (!startTime) startTime = Date.now();
  const value = removeDiacritics(e.target.value.trim());
  const current = removeDiacritics(text[index]);

  if (value === current) {
    index++;
    e.target.value = "";
    renderText();
    updateStats();
  }
});

function startTest(sec) {
  duration = sec;
  startTime = Date.now();
  generateText();
  document.getElementById("input").value = "";
  clearTimeout(timer);

  timer = setTimeout(endTest, sec * 1000);
}

function updateStats() {
  const time = (Date.now() - startTime) / 60000;
  const wpm = Math.round(index / time || 0);
  document.getElementById("stats").innerText = `WPM: ${wpm}`;
}

function endTest() {
  const time = (Date.now() - startTime) / 60000;
  const wpm = Math.round(index / time || 0);
  saveScore(wpm);
  loadRanking();
  alert("Ho√†n th√†nh! WPM: " + wpm);
}

function saveScore(wpm) {
  let data = JSON.parse(localStorage.getItem("ranking") || "[]");
  data.push({ wpm, time: Date.now() });
  data.sort((a,b) => b.wpm - a.wpm);
  data = data.slice(0,100);
  localStorage.setItem("ranking", JSON.stringify(data));
}

function loadRanking() {
  const list = document.getElementById("rankList");
  const data = JSON.parse(localStorage.getItem("ranking") || "[]");
  list.innerHTML = "";
  data.forEach((r,i) => {
    list.innerHTML += `<li>${r.wpm} WPM</li>`;
  });
}

/* CH·∫æ ƒê·ªò 1: v·ª´a v√†o l√† c√≥ ch·ªØ */
generateText();
loadRanking();
</script>
</body>
</html>
